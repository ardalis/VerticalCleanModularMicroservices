2025-10-28 16:51:10.207 +01:00 [INF] Registered 5 endpoints in 1,803 milliseconds.
2025-10-28 16:51:10.809 +01:00 [WRN] DROPPING database for fresh start (DatabaseOptions:RecreateOnStartup = true)...
2025-10-28 16:51:11.854 +01:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-28 16:51:15.030 +01:00 [INF] Executed DbCommand (3,047ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [AppDb] SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
END;
2025-10-28 16:51:15.096 +01:00 [INF] Executed DbCommand (65ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
DROP DATABASE [AppDb];
2025-10-28 16:51:15.101 +01:00 [INF] Database dropped.
2025-10-28 16:51:15.101 +01:00 [INF] Applying database migrations...
2025-10-28 16:51:15.650 +01:00 [INF] Executed DbCommand (348ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [AppDb];
2025-10-28 16:51:15.864 +01:00 [INF] Executed DbCommand (213ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [AppDb] SET READ_COMMITTED_SNAPSHOT ON;
END;
2025-10-28 16:51:15.926 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-28 16:51:15.929 +01:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-28 16:51:15.962 +01:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-28 16:51:16.027 +01:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-28 16:51:16.054 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-28 16:51:16.059 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-28 16:51:16.099 +01:00 [INF] Executed DbCommand (36ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-28 16:51:16.113 +01:00 [INF] Applying migration '20251020223304_Initial'.
2025-10-28 16:51:16.151 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Carts] (
    [Id] uniqueidentifier NOT NULL,
    [CreatedOn] datetime2 NOT NULL,
    [Deleted] bit NOT NULL,
    CONSTRAINT [PK_Carts] PRIMARY KEY ([Id])
);
2025-10-28 16:51:16.156 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Products] (
    [Id] int NOT NULL,
    [Name] nvarchar(100) NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    CONSTRAINT [PK_Products] PRIMARY KEY ([Id])
);
2025-10-28 16:51:16.160 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [CartItems] (
    [Id] uniqueidentifier NOT NULL,
    [ProductId] int NOT NULL,
    [Quantity] int NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    [CartId] uniqueidentifier NULL,
    CONSTRAINT [PK_CartItems] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_CartItems_Carts_CartId] FOREIGN KEY ([CartId]) REFERENCES [Carts] ([Id])
);
2025-10-28 16:51:16.238 +01:00 [INF] Executed DbCommand (78ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name', N'UnitPrice') AND [object_id] = OBJECT_ID(N'[Products]'))
    SET IDENTITY_INSERT [Products] ON;
INSERT INTO [Products] ([Id], [Name], [UnitPrice])
VALUES (1, N'Laptop', 999.99),
(2, N'Smartphone', 499.99),
(3, N'Tablet', 299.99);
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name', N'UnitPrice') AND [object_id] = OBJECT_ID(N'[Products]'))
    SET IDENTITY_INSERT [Products] OFF;
2025-10-28 16:51:16.241 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_CartItems_CartId] ON [CartItems] ([CartId]);
2025-10-28 16:51:16.249 +01:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20251020223304_Initial', N'9.0.10');
2025-10-28 16:51:16.249 +01:00 [INF] Applying migration '20251024232246_AddGuestUsersAndOrdersSqlServer'.
2025-10-28 16:51:16.272 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [GuestUsers] (
    [Id] uniqueidentifier NOT NULL,
    [Email] nvarchar(100) NOT NULL,
    CONSTRAINT [PK_GuestUsers] PRIMARY KEY ([Id])
);
2025-10-28 16:51:16.276 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Orders] (
    [Id] uniqueidentifier NOT NULL,
    [CreatedOn] datetimeoffset NOT NULL,
    [GuestUserId] uniqueidentifier NOT NULL,
    [DatePaid] datetimeoffset NULL,
    [PaymentReference] nvarchar(100) NULL,
    CONSTRAINT [PK_Orders] PRIMARY KEY ([Id])
);
2025-10-28 16:51:16.280 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [OrderItems] (
    [Id] uniqueidentifier NOT NULL,
    [OrderId] uniqueidentifier NOT NULL,
    [ProductId] int NOT NULL,
    [Quantity] int NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    CONSTRAINT [PK_OrderItems] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_OrderItems_Orders_OrderId] FOREIGN KEY ([OrderId]) REFERENCES [Orders] ([Id]) ON DELETE CASCADE
);
2025-10-28 16:51:16.284 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE [Products] SET [Name] = N'Coffee Mug', [UnitPrice] = 9.99
WHERE [Id] = 1;
SELECT @@ROWCOUNT;
2025-10-28 16:51:16.288 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE [Products] SET [Name] = N'T-Shirt', [UnitPrice] = 19.99
WHERE [Id] = 2;
SELECT @@ROWCOUNT;
2025-10-28 16:51:16.292 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE [Products] SET [Name] = N'Sticker Pack', [UnitPrice] = 3.99
WHERE [Id] = 3;
SELECT @@ROWCOUNT;
2025-10-28 16:51:16.295 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_OrderItems_OrderId] ON [OrderItems] ([OrderId]);
2025-10-28 16:51:16.298 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20251024232246_AddGuestUsersAndOrdersSqlServer', N'9.0.10');
2025-10-28 16:51:16.313 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-28 16:51:16.314 +01:00 [INF] Database migrations applied successfully.
2025-10-28 16:51:16.522 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Products] AS [p]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-28 16:51:16.526 +01:00 [INF] DB has data - seeding not required.
2025-10-28 16:51:16.835 +01:00 [INF] Now listening on: https://localhost:54777
2025-10-28 16:51:16.843 +01:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-10-28 16:51:17.521 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-28 16:51:17.521 +01:00 [INF] Hosting environment: Development
2025-10-28 16:51:17.521 +01:00 [INF] Content root path: C:\dev\github-ardalis\VerticalCleanModularMicroservices\05-CleanVertical\src\OrderDemo.CleanArch.Web
2025-10-28 16:56:22.943 +01:00 [INF] Request starting HTTP/1.1 GET https://localhost:57679/products - null null
2025-10-28 16:56:22.963 +01:00 [INF] Executing endpoint 'HTTP: GET /Products'
2025-10-28 16:56:23.062 +01:00 [INF] Executed DbCommand (19ms) [Parameters=[@__p_0='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
ORDER BY [p].[Id]
OFFSET @__p_0 ROWS FETCH NEXT @__p_1 ROWS ONLY
2025-10-28 16:56:23.098 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Products] AS [p]
2025-10-28 16:56:23.125 +01:00 [INF] Executed endpoint 'HTTP: GET /Products'
2025-10-28 16:56:23.128 +01:00 [INF] Request finished HTTP/1.1 GET https://localhost:57679/products - 200 null application/json; charset=utf-8 191.9526ms
2025-10-28 17:15:44.416 +01:00 [INF] Registered 6 endpoints in 246 milliseconds.
2025-10-28 17:15:44.595 +01:00 [WRN] DROPPING database for fresh start (DatabaseOptions:RecreateOnStartup = true)...
2025-10-28 17:15:45.549 +01:00 [INF] Executed DbCommand (46ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-28 17:15:48.677 +01:00 [INF] Executed DbCommand (3,034ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [AppDb] SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
END;
2025-10-28 17:15:48.745 +01:00 [INF] Executed DbCommand (68ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
DROP DATABASE [AppDb];
2025-10-28 17:15:48.749 +01:00 [INF] Database dropped.
2025-10-28 17:15:48.749 +01:00 [INF] Applying database migrations...
2025-10-28 17:15:49.222 +01:00 [INF] Executed DbCommand (302ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [AppDb];
2025-10-28 17:15:49.426 +01:00 [INF] Executed DbCommand (202ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [AppDb] SET READ_COMMITTED_SNAPSHOT ON;
END;
2025-10-28 17:15:49.478 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-28 17:15:49.481 +01:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-28 17:15:49.506 +01:00 [INF] Executed DbCommand (22ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-28 17:15:49.589 +01:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-28 17:15:49.612 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-28 17:15:49.615 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-28 17:15:49.647 +01:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-28 17:15:49.661 +01:00 [INF] Applying migration '20251020223304_Initial'.
2025-10-28 17:15:49.692 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Carts] (
    [Id] uniqueidentifier NOT NULL,
    [CreatedOn] datetime2 NOT NULL,
    [Deleted] bit NOT NULL,
    CONSTRAINT [PK_Carts] PRIMARY KEY ([Id])
);
2025-10-28 17:15:49.695 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Products] (
    [Id] int NOT NULL,
    [Name] nvarchar(100) NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    CONSTRAINT [PK_Products] PRIMARY KEY ([Id])
);
2025-10-28 17:15:49.698 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [CartItems] (
    [Id] uniqueidentifier NOT NULL,
    [ProductId] int NOT NULL,
    [Quantity] int NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    [CartId] uniqueidentifier NULL,
    CONSTRAINT [PK_CartItems] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_CartItems_Carts_CartId] FOREIGN KEY ([CartId]) REFERENCES [Carts] ([Id])
);
2025-10-28 17:15:49.764 +01:00 [INF] Executed DbCommand (66ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name', N'UnitPrice') AND [object_id] = OBJECT_ID(N'[Products]'))
    SET IDENTITY_INSERT [Products] ON;
INSERT INTO [Products] ([Id], [Name], [UnitPrice])
VALUES (1, N'Laptop', 999.99),
(2, N'Smartphone', 499.99),
(3, N'Tablet', 299.99);
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name', N'UnitPrice') AND [object_id] = OBJECT_ID(N'[Products]'))
    SET IDENTITY_INSERT [Products] OFF;
2025-10-28 17:15:49.767 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_CartItems_CartId] ON [CartItems] ([CartId]);
2025-10-28 17:15:49.771 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20251020223304_Initial', N'9.0.10');
2025-10-28 17:15:49.771 +01:00 [INF] Applying migration '20251024232246_AddGuestUsersAndOrdersSqlServer'.
2025-10-28 17:15:49.789 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [GuestUsers] (
    [Id] uniqueidentifier NOT NULL,
    [Email] nvarchar(100) NOT NULL,
    CONSTRAINT [PK_GuestUsers] PRIMARY KEY ([Id])
);
2025-10-28 17:15:49.791 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Orders] (
    [Id] uniqueidentifier NOT NULL,
    [CreatedOn] datetimeoffset NOT NULL,
    [GuestUserId] uniqueidentifier NOT NULL,
    [DatePaid] datetimeoffset NULL,
    [PaymentReference] nvarchar(100) NULL,
    CONSTRAINT [PK_Orders] PRIMARY KEY ([Id])
);
2025-10-28 17:15:49.794 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [OrderItems] (
    [Id] uniqueidentifier NOT NULL,
    [OrderId] uniqueidentifier NOT NULL,
    [ProductId] int NOT NULL,
    [Quantity] int NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    CONSTRAINT [PK_OrderItems] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_OrderItems_Orders_OrderId] FOREIGN KEY ([OrderId]) REFERENCES [Orders] ([Id]) ON DELETE CASCADE
);
2025-10-28 17:15:49.798 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE [Products] SET [Name] = N'Coffee Mug', [UnitPrice] = 9.99
WHERE [Id] = 1;
SELECT @@ROWCOUNT;
2025-10-28 17:15:49.802 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE [Products] SET [Name] = N'T-Shirt', [UnitPrice] = 19.99
WHERE [Id] = 2;
SELECT @@ROWCOUNT;
2025-10-28 17:15:49.804 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE [Products] SET [Name] = N'Sticker Pack', [UnitPrice] = 3.99
WHERE [Id] = 3;
SELECT @@ROWCOUNT;
2025-10-28 17:15:49.806 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_OrderItems_OrderId] ON [OrderItems] ([OrderId]);
2025-10-28 17:15:49.808 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20251024232246_AddGuestUsersAndOrdersSqlServer', N'9.0.10');
2025-10-28 17:15:49.823 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-28 17:15:49.824 +01:00 [INF] Database migrations applied successfully.
2025-10-28 17:15:49.982 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Products] AS [p]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-28 17:15:49.985 +01:00 [INF] DB has data - seeding not required.
2025-10-28 17:15:50.150 +01:00 [INF] Now listening on: https://localhost:59507
2025-10-28 17:15:50.153 +01:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-10-28 17:15:50.213 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-28 17:15:50.214 +01:00 [INF] Hosting environment: Development
2025-10-28 17:15:50.214 +01:00 [INF] Content root path: C:\dev\github-ardalis\VerticalCleanModularMicroservices\05-CleanVertical\src\OrderDemo.CleanArch.Web
2025-10-28 17:15:54.005 +01:00 [INF] Request starting HTTP/1.1 GET https://localhost:57679/products - null null
2025-10-28 17:15:54.041 +01:00 [INF] Executing endpoint 'HTTP: GET /Products'
2025-10-28 17:15:54.140 +01:00 [INF] Executed DbCommand (12ms) [Parameters=[@__p_0='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
ORDER BY [p].[Id]
OFFSET @__p_0 ROWS FETCH NEXT @__p_1 ROWS ONLY
2025-10-28 17:15:54.171 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Products] AS [p]
2025-10-28 17:15:54.210 +01:00 [INF] Executed endpoint 'HTTP: GET /Products'
2025-10-28 17:15:54.213 +01:00 [INF] Request finished HTTP/1.1 GET https://localhost:57679/products - 200 null application/json; charset=utf-8 214.3433ms
2025-10-28 17:18:14.251 +01:00 [INF] Registered 6 endpoints in 298 milliseconds.
2025-10-28 17:18:14.443 +01:00 [WRN] DROPPING database for fresh start (DatabaseOptions:RecreateOnStartup = true)...
2025-10-28 17:18:15.351 +01:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-28 17:18:18.441 +01:00 [INF] Executed DbCommand (2,992ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [AppDb] SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
END;
2025-10-28 17:18:18.491 +01:00 [INF] Executed DbCommand (49ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
DROP DATABASE [AppDb];
2025-10-28 17:18:18.494 +01:00 [INF] Database dropped.
2025-10-28 17:18:18.494 +01:00 [INF] Applying database migrations...
2025-10-28 17:18:18.956 +01:00 [INF] Executed DbCommand (323ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [AppDb];
2025-10-28 17:18:19.154 +01:00 [INF] Executed DbCommand (197ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [AppDb] SET READ_COMMITTED_SNAPSHOT ON;
END;
2025-10-28 17:18:19.215 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-28 17:18:19.217 +01:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-28 17:18:19.237 +01:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-28 17:18:19.279 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-28 17:18:19.300 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-28 17:18:19.302 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-28 17:18:19.345 +01:00 [INF] Executed DbCommand (38ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-28 17:18:19.356 +01:00 [INF] Applying migration '20251020223304_Initial'.
2025-10-28 17:18:19.378 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Carts] (
    [Id] uniqueidentifier NOT NULL,
    [CreatedOn] datetime2 NOT NULL,
    [Deleted] bit NOT NULL,
    CONSTRAINT [PK_Carts] PRIMARY KEY ([Id])
);
2025-10-28 17:18:19.383 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Products] (
    [Id] int NOT NULL,
    [Name] nvarchar(100) NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    CONSTRAINT [PK_Products] PRIMARY KEY ([Id])
);
2025-10-28 17:18:19.387 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [CartItems] (
    [Id] uniqueidentifier NOT NULL,
    [ProductId] int NOT NULL,
    [Quantity] int NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    [CartId] uniqueidentifier NULL,
    CONSTRAINT [PK_CartItems] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_CartItems_Carts_CartId] FOREIGN KEY ([CartId]) REFERENCES [Carts] ([Id])
);
2025-10-28 17:18:19.447 +01:00 [INF] Executed DbCommand (60ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name', N'UnitPrice') AND [object_id] = OBJECT_ID(N'[Products]'))
    SET IDENTITY_INSERT [Products] ON;
INSERT INTO [Products] ([Id], [Name], [UnitPrice])
VALUES (1, N'Laptop', 999.99),
(2, N'Smartphone', 499.99),
(3, N'Tablet', 299.99);
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name', N'UnitPrice') AND [object_id] = OBJECT_ID(N'[Products]'))
    SET IDENTITY_INSERT [Products] OFF;
2025-10-28 17:18:19.450 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_CartItems_CartId] ON [CartItems] ([CartId]);
2025-10-28 17:18:19.453 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20251020223304_Initial', N'9.0.10');
2025-10-28 17:18:19.453 +01:00 [INF] Applying migration '20251024232246_AddGuestUsersAndOrdersSqlServer'.
2025-10-28 17:18:19.468 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [GuestUsers] (
    [Id] uniqueidentifier NOT NULL,
    [Email] nvarchar(100) NOT NULL,
    CONSTRAINT [PK_GuestUsers] PRIMARY KEY ([Id])
);
2025-10-28 17:18:19.471 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Orders] (
    [Id] uniqueidentifier NOT NULL,
    [CreatedOn] datetimeoffset NOT NULL,
    [GuestUserId] uniqueidentifier NOT NULL,
    [DatePaid] datetimeoffset NULL,
    [PaymentReference] nvarchar(100) NULL,
    CONSTRAINT [PK_Orders] PRIMARY KEY ([Id])
);
2025-10-28 17:18:19.475 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [OrderItems] (
    [Id] uniqueidentifier NOT NULL,
    [OrderId] uniqueidentifier NOT NULL,
    [ProductId] int NOT NULL,
    [Quantity] int NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    CONSTRAINT [PK_OrderItems] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_OrderItems_Orders_OrderId] FOREIGN KEY ([OrderId]) REFERENCES [Orders] ([Id]) ON DELETE CASCADE
);
2025-10-28 17:18:19.480 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE [Products] SET [Name] = N'Coffee Mug', [UnitPrice] = 9.99
WHERE [Id] = 1;
SELECT @@ROWCOUNT;
2025-10-28 17:18:19.484 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE [Products] SET [Name] = N'T-Shirt', [UnitPrice] = 19.99
WHERE [Id] = 2;
SELECT @@ROWCOUNT;
2025-10-28 17:18:19.486 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE [Products] SET [Name] = N'Sticker Pack', [UnitPrice] = 3.99
WHERE [Id] = 3;
SELECT @@ROWCOUNT;
2025-10-28 17:18:19.492 +01:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_OrderItems_OrderId] ON [OrderItems] ([OrderId]);
2025-10-28 17:18:19.495 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20251024232246_AddGuestUsersAndOrdersSqlServer', N'9.0.10');
2025-10-28 17:18:19.510 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-28 17:18:19.511 +01:00 [INF] Database migrations applied successfully.
2025-10-28 17:18:19.649 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Products] AS [p]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-28 17:18:19.650 +01:00 [INF] DB has data - seeding not required.
2025-10-28 17:18:19.789 +01:00 [INF] Now listening on: https://localhost:62805
2025-10-28 17:18:19.791 +01:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-10-28 17:18:20.208 +01:00 [INF] Request starting HTTP/1.1 GET https://localhost:57679/products - null null
2025-10-28 17:18:20.230 +01:00 [INF] Executing endpoint 'HTTP: GET /Products'
2025-10-28 17:18:20.242 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-28 17:18:20.242 +01:00 [INF] Hosting environment: Development
2025-10-28 17:18:20.242 +01:00 [INF] Content root path: C:\dev\github-ardalis\VerticalCleanModularMicroservices\05-CleanVertical\src\OrderDemo.CleanArch.Web
2025-10-28 17:18:20.266 +01:00 [INF] Handling ListProductsQuery
2025-10-28 17:18:20.266 +01:00 [INF] Property Page : 1
2025-10-28 17:18:20.266 +01:00 [INF] Property PerPage : 10
2025-10-28 17:18:20.344 +01:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_0='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
ORDER BY [p].[Id]
OFFSET @__p_0 ROWS FETCH NEXT @__p_1 ROWS ONLY
2025-10-28 17:18:20.372 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Products] AS [p]
2025-10-28 17:18:20.374 +01:00 [INF] Handled ListProductsQuery with Ardalis.Result.Result`1[OrderDemo.CleanVertical.Web.PagedResult`1[OrderDemo.CleanVertical.Web.ProductFeatures.ProductDto]] in 107 ms
2025-10-28 17:18:20.384 +01:00 [INF] Executed endpoint 'HTTP: GET /Products'
2025-10-28 17:18:20.389 +01:00 [INF] Request finished HTTP/1.1 GET https://localhost:57679/products - 200 null application/json; charset=utf-8 188.7045ms
2025-10-28 17:19:17.748 +01:00 [INF] Registered 6 endpoints in 273 milliseconds.
2025-10-28 17:19:17.995 +01:00 [WRN] DROPPING database for fresh start (DatabaseOptions:RecreateOnStartup = true)...
2025-10-28 17:19:18.954 +01:00 [INF] Executed DbCommand (26ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-28 17:19:22.066 +01:00 [INF] Executed DbCommand (3,010ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [AppDb] SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
END;
2025-10-28 17:19:22.116 +01:00 [INF] Executed DbCommand (49ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
DROP DATABASE [AppDb];
2025-10-28 17:19:22.120 +01:00 [INF] Database dropped.
2025-10-28 17:19:22.120 +01:00 [INF] Applying database migrations...
2025-10-28 17:19:22.625 +01:00 [INF] Executed DbCommand (319ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [AppDb];
2025-10-28 17:19:22.810 +01:00 [INF] Executed DbCommand (184ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [AppDb] SET READ_COMMITTED_SNAPSHOT ON;
END;
2025-10-28 17:19:22.870 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-28 17:19:22.873 +01:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-28 17:19:22.904 +01:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-28 17:19:22.994 +01:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-28 17:19:23.021 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-28 17:19:23.024 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-28 17:19:23.071 +01:00 [INF] Executed DbCommand (43ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-28 17:19:23.083 +01:00 [INF] Applying migration '20251020223304_Initial'.
2025-10-28 17:19:23.119 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Carts] (
    [Id] uniqueidentifier NOT NULL,
    [CreatedOn] datetime2 NOT NULL,
    [Deleted] bit NOT NULL,
    CONSTRAINT [PK_Carts] PRIMARY KEY ([Id])
);
2025-10-28 17:19:23.124 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Products] (
    [Id] int NOT NULL,
    [Name] nvarchar(100) NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    CONSTRAINT [PK_Products] PRIMARY KEY ([Id])
);
2025-10-28 17:19:23.128 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [CartItems] (
    [Id] uniqueidentifier NOT NULL,
    [ProductId] int NOT NULL,
    [Quantity] int NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    [CartId] uniqueidentifier NULL,
    CONSTRAINT [PK_CartItems] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_CartItems_Carts_CartId] FOREIGN KEY ([CartId]) REFERENCES [Carts] ([Id])
);
2025-10-28 17:19:23.202 +01:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name', N'UnitPrice') AND [object_id] = OBJECT_ID(N'[Products]'))
    SET IDENTITY_INSERT [Products] ON;
INSERT INTO [Products] ([Id], [Name], [UnitPrice])
VALUES (1, N'Laptop', 999.99),
(2, N'Smartphone', 499.99),
(3, N'Tablet', 299.99);
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name', N'UnitPrice') AND [object_id] = OBJECT_ID(N'[Products]'))
    SET IDENTITY_INSERT [Products] OFF;
2025-10-28 17:19:23.205 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_CartItems_CartId] ON [CartItems] ([CartId]);
2025-10-28 17:19:23.208 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20251020223304_Initial', N'9.0.10');
2025-10-28 17:19:23.208 +01:00 [INF] Applying migration '20251024232246_AddGuestUsersAndOrdersSqlServer'.
2025-10-28 17:19:23.228 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [GuestUsers] (
    [Id] uniqueidentifier NOT NULL,
    [Email] nvarchar(100) NOT NULL,
    CONSTRAINT [PK_GuestUsers] PRIMARY KEY ([Id])
);
2025-10-28 17:19:23.232 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Orders] (
    [Id] uniqueidentifier NOT NULL,
    [CreatedOn] datetimeoffset NOT NULL,
    [GuestUserId] uniqueidentifier NOT NULL,
    [DatePaid] datetimeoffset NULL,
    [PaymentReference] nvarchar(100) NULL,
    CONSTRAINT [PK_Orders] PRIMARY KEY ([Id])
);
2025-10-28 17:19:23.236 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [OrderItems] (
    [Id] uniqueidentifier NOT NULL,
    [OrderId] uniqueidentifier NOT NULL,
    [ProductId] int NOT NULL,
    [Quantity] int NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    CONSTRAINT [PK_OrderItems] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_OrderItems_Orders_OrderId] FOREIGN KEY ([OrderId]) REFERENCES [Orders] ([Id]) ON DELETE CASCADE
);
2025-10-28 17:19:23.241 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE [Products] SET [Name] = N'Coffee Mug', [UnitPrice] = 9.99
WHERE [Id] = 1;
SELECT @@ROWCOUNT;
2025-10-28 17:19:23.247 +01:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE [Products] SET [Name] = N'T-Shirt', [UnitPrice] = 19.99
WHERE [Id] = 2;
SELECT @@ROWCOUNT;
2025-10-28 17:19:23.249 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE [Products] SET [Name] = N'Sticker Pack', [UnitPrice] = 3.99
WHERE [Id] = 3;
SELECT @@ROWCOUNT;
2025-10-28 17:19:23.252 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_OrderItems_OrderId] ON [OrderItems] ([OrderId]);
2025-10-28 17:19:23.254 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20251024232246_AddGuestUsersAndOrdersSqlServer', N'9.0.10');
2025-10-28 17:19:23.269 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-28 17:19:23.270 +01:00 [INF] Database migrations applied successfully.
2025-10-28 17:19:23.490 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Products] AS [p]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-28 17:19:23.495 +01:00 [INF] DB has data - seeding not required.
2025-10-28 17:19:23.698 +01:00 [INF] Now listening on: https://localhost:55052
2025-10-28 17:19:23.701 +01:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-10-28 17:19:23.785 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-28 17:19:23.785 +01:00 [INF] Hosting environment: Development
2025-10-28 17:19:23.785 +01:00 [INF] Content root path: C:\dev\github-ardalis\VerticalCleanModularMicroservices\05-CleanVertical\src\OrderDemo.CleanArch.Web
2025-10-28 17:19:31.642 +01:00 [INF] Request starting HTTP/1.1 GET https://localhost:57679/products - null null
2025-10-28 17:19:31.666 +01:00 [INF] Executing endpoint 'HTTP: GET /Products'
2025-10-28 17:19:31.690 +01:00 [INF] Handling ListProductsQuery
2025-10-28 17:19:31.691 +01:00 [INF] Property Page : 1
2025-10-28 17:19:31.691 +01:00 [INF] Property PerPage : 10
2025-10-28 17:19:31.737 +01:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_0='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
ORDER BY [p].[Id]
OFFSET @__p_0 ROWS FETCH NEXT @__p_1 ROWS ONLY
2025-10-28 17:19:31.763 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Products] AS [p]
2025-10-28 17:19:31.764 +01:00 [INF] Handled ListProductsQuery with Ardalis.Result.Result`1[OrderDemo.CleanVertical.Web.PagedResult`1[OrderDemo.CleanVertical.Web.ProductFeatures.ProductDto]] in 73 ms
2025-10-28 17:19:31.773 +01:00 [INF] Executed endpoint 'HTTP: GET /Products'
2025-10-28 17:19:31.777 +01:00 [INF] Request finished HTTP/1.1 GET https://localhost:57679/products - 200 null application/json; charset=utf-8 142.4725ms
2025-10-28 17:24:21.463 +01:00 [INF] Registered 6 endpoints in 290 milliseconds.
2025-10-28 17:24:21.667 +01:00 [WRN] DROPPING database for fresh start (DatabaseOptions:RecreateOnStartup = true)...
2025-10-28 17:24:22.497 +01:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-28 17:24:25.608 +01:00 [INF] Executed DbCommand (3,017ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [AppDb] SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
END;
2025-10-28 17:24:25.680 +01:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
DROP DATABASE [AppDb];
2025-10-28 17:24:25.685 +01:00 [INF] Database dropped.
2025-10-28 17:24:25.685 +01:00 [INF] Applying database migrations...
2025-10-28 17:24:26.274 +01:00 [INF] Executed DbCommand (373ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [AppDb];
2025-10-28 17:24:26.555 +01:00 [INF] Executed DbCommand (280ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [AppDb] SET READ_COMMITTED_SNAPSHOT ON;
END;
2025-10-28 17:24:26.623 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-28 17:24:26.627 +01:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-28 17:24:26.658 +01:00 [INF] Executed DbCommand (27ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-28 17:24:26.728 +01:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-28 17:24:26.755 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-28 17:24:26.758 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-28 17:24:26.801 +01:00 [INF] Executed DbCommand (40ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-28 17:24:26.814 +01:00 [INF] Applying migration '20251020223304_Initial'.
2025-10-28 17:24:26.853 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Carts] (
    [Id] uniqueidentifier NOT NULL,
    [CreatedOn] datetime2 NOT NULL,
    [Deleted] bit NOT NULL,
    CONSTRAINT [PK_Carts] PRIMARY KEY ([Id])
);
2025-10-28 17:24:26.857 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Products] (
    [Id] int NOT NULL,
    [Name] nvarchar(100) NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    CONSTRAINT [PK_Products] PRIMARY KEY ([Id])
);
2025-10-28 17:24:26.861 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [CartItems] (
    [Id] uniqueidentifier NOT NULL,
    [ProductId] int NOT NULL,
    [Quantity] int NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    [CartId] uniqueidentifier NULL,
    CONSTRAINT [PK_CartItems] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_CartItems_Carts_CartId] FOREIGN KEY ([CartId]) REFERENCES [Carts] ([Id])
);
2025-10-28 17:24:26.940 +01:00 [INF] Executed DbCommand (79ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name', N'UnitPrice') AND [object_id] = OBJECT_ID(N'[Products]'))
    SET IDENTITY_INSERT [Products] ON;
INSERT INTO [Products] ([Id], [Name], [UnitPrice])
VALUES (1, N'Laptop', 999.99),
(2, N'Smartphone', 499.99),
(3, N'Tablet', 299.99);
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name', N'UnitPrice') AND [object_id] = OBJECT_ID(N'[Products]'))
    SET IDENTITY_INSERT [Products] OFF;
2025-10-28 17:24:26.943 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_CartItems_CartId] ON [CartItems] ([CartId]);
2025-10-28 17:24:26.947 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20251020223304_Initial', N'9.0.10');
2025-10-28 17:24:26.948 +01:00 [INF] Applying migration '20251024232246_AddGuestUsersAndOrdersSqlServer'.
2025-10-28 17:24:26.966 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [GuestUsers] (
    [Id] uniqueidentifier NOT NULL,
    [Email] nvarchar(100) NOT NULL,
    CONSTRAINT [PK_GuestUsers] PRIMARY KEY ([Id])
);
2025-10-28 17:24:26.969 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Orders] (
    [Id] uniqueidentifier NOT NULL,
    [CreatedOn] datetimeoffset NOT NULL,
    [GuestUserId] uniqueidentifier NOT NULL,
    [DatePaid] datetimeoffset NULL,
    [PaymentReference] nvarchar(100) NULL,
    CONSTRAINT [PK_Orders] PRIMARY KEY ([Id])
);
2025-10-28 17:24:26.972 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [OrderItems] (
    [Id] uniqueidentifier NOT NULL,
    [OrderId] uniqueidentifier NOT NULL,
    [ProductId] int NOT NULL,
    [Quantity] int NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    CONSTRAINT [PK_OrderItems] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_OrderItems_Orders_OrderId] FOREIGN KEY ([OrderId]) REFERENCES [Orders] ([Id]) ON DELETE CASCADE
);
2025-10-28 17:24:26.976 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE [Products] SET [Name] = N'Coffee Mug', [UnitPrice] = 9.99
WHERE [Id] = 1;
SELECT @@ROWCOUNT;
2025-10-28 17:24:26.982 +01:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE [Products] SET [Name] = N'T-Shirt', [UnitPrice] = 19.99
WHERE [Id] = 2;
SELECT @@ROWCOUNT;
2025-10-28 17:24:26.984 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE [Products] SET [Name] = N'Sticker Pack', [UnitPrice] = 3.99
WHERE [Id] = 3;
SELECT @@ROWCOUNT;
2025-10-28 17:24:26.988 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_OrderItems_OrderId] ON [OrderItems] ([OrderId]);
2025-10-28 17:24:26.990 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20251024232246_AddGuestUsersAndOrdersSqlServer', N'9.0.10');
2025-10-28 17:24:27.004 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-28 17:24:27.006 +01:00 [INF] Database migrations applied successfully.
2025-10-28 17:24:27.200 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Products] AS [p]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-28 17:24:27.204 +01:00 [INF] DB has data - seeding not required.
2025-10-28 17:24:27.404 +01:00 [INF] Now listening on: https://localhost:64908
2025-10-28 17:24:27.408 +01:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-10-28 17:24:28.122 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-28 17:24:28.122 +01:00 [INF] Hosting environment: Development
2025-10-28 17:24:28.122 +01:00 [INF] Content root path: C:\dev\github-ardalis\VerticalCleanModularMicroservices\05-CleanVertical\src\OrderDemo.CleanArch.Web
2025-10-28 17:24:34.741 +01:00 [INF] Request starting HTTP/1.1 GET https://localhost:57679/products - null null
2025-10-28 17:24:34.773 +01:00 [INF] Executing endpoint 'HTTP: GET /Products'
2025-10-28 17:24:34.810 +01:00 [INF] Handling ListProductsQuery: {"Page":1,"PerPage":10,"$type":"ListProductsQuery"}
2025-10-28 17:24:34.869 +01:00 [INF] Executed DbCommand (13ms) [Parameters=[@__p_0='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
ORDER BY [p].[Id]
OFFSET @__p_0 ROWS FETCH NEXT @__p_1 ROWS ONLY
2025-10-28 17:24:34.897 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Products] AS [p]
2025-10-28 17:24:34.898 +01:00 [INF] Handled ListProductsQuery with Ardalis.Result.Result`1[OrderDemo.CleanVertical.Web.PagedResult`1[OrderDemo.CleanVertical.Web.ProductFeatures.ProductDto]] in 86 ms
2025-10-28 17:24:34.909 +01:00 [INF] Executed endpoint 'HTTP: GET /Products'
2025-10-28 17:24:34.913 +01:00 [INF] Request finished HTTP/1.1 GET https://localhost:57679/products - 200 null application/json; charset=utf-8 179.7773ms
