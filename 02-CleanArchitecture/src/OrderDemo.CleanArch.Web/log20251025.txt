2025-10-25 00:04:13.522 +01:00 [INF] Registered 4 endpoints in 264 milliseconds.
2025-10-25 00:04:13.727 +01:00 [WRN] DROPPING database for fresh start (DatabaseOptions:RecreateOnStartup = true)...
2025-10-25 00:04:14.676 +01:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-25 00:04:17.838 +01:00 [INF] Executed DbCommand (3,068ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [AppDb] SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
END;
2025-10-25 00:04:17.902 +01:00 [INF] Executed DbCommand (63ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
DROP DATABASE [AppDb];
2025-10-25 00:04:17.907 +01:00 [INF] Database dropped.
2025-10-25 00:04:17.907 +01:00 [INF] Applying database migrations...
2025-10-25 00:04:18.312 +01:00 [INF] Executed DbCommand (272ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [AppDb];
2025-10-25 00:04:18.479 +01:00 [INF] Executed DbCommand (167ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [AppDb] SET READ_COMMITTED_SNAPSHOT ON;
END;
2025-10-25 00:04:18.533 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-25 00:04:18.536 +01:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-25 00:04:18.566 +01:00 [INF] Executed DbCommand (26ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-25 00:04:18.666 +01:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-25 00:04:18.692 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-25 00:04:18.696 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-25 00:04:18.741 +01:00 [INF] Executed DbCommand (42ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-25 00:04:18.758 +01:00 [INF] Applying migration '20251020223304_Initial'.
2025-10-25 00:04:18.804 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Carts] (
    [Id] uniqueidentifier NOT NULL,
    [CreatedOn] datetime2 NOT NULL,
    [Deleted] bit NOT NULL,
    CONSTRAINT [PK_Carts] PRIMARY KEY ([Id])
);
2025-10-25 00:04:18.807 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Products] (
    [Id] int NOT NULL,
    [Name] nvarchar(100) NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    CONSTRAINT [PK_Products] PRIMARY KEY ([Id])
);
2025-10-25 00:04:18.810 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [CartItems] (
    [Id] uniqueidentifier NOT NULL,
    [ProductId] int NOT NULL,
    [Quantity] int NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    [CartId] uniqueidentifier NULL,
    CONSTRAINT [PK_CartItems] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_CartItems_Carts_CartId] FOREIGN KEY ([CartId]) REFERENCES [Carts] ([Id])
);
2025-10-25 00:04:18.867 +01:00 [INF] Executed DbCommand (57ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name', N'UnitPrice') AND [object_id] = OBJECT_ID(N'[Products]'))
    SET IDENTITY_INSERT [Products] ON;
INSERT INTO [Products] ([Id], [Name], [UnitPrice])
VALUES (1, N'Laptop', 999.99),
(2, N'Smartphone', 499.99),
(3, N'Tablet', 299.99);
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name', N'UnitPrice') AND [object_id] = OBJECT_ID(N'[Products]'))
    SET IDENTITY_INSERT [Products] OFF;
2025-10-25 00:04:18.870 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_CartItems_CartId] ON [CartItems] ([CartId]);
2025-10-25 00:04:18.873 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20251020223304_Initial', N'9.0.10');
2025-10-25 00:04:18.885 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-25 00:04:18.886 +01:00 [INF] Database migrations applied successfully.
2025-10-25 00:04:19.143 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Products] AS [p]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-25 00:04:19.147 +01:00 [INF] DB has data - seeding not required.
2025-10-25 00:04:19.425 +01:00 [INF] Now listening on: https://localhost:62957
2025-10-25 00:04:19.430 +01:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-10-25 00:04:19.511 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-25 00:04:19.511 +01:00 [INF] Hosting environment: Development
2025-10-25 00:04:19.511 +01:00 [INF] Content root path: C:\dev\github-ardalis\VerticalCleanModularMicroservices\02-CleanArchitecture\src\OrderDemo.CleanArch.Web
2025-10-25 00:04:25.031 +01:00 [INF] Request starting HTTP/1.1 GET https://localhost:57679/products - null null
2025-10-25 00:04:25.054 +01:00 [INF] Executing endpoint 'HTTP: GET /Products'
2025-10-25 00:04:25.125 +01:00 [INF] Executed DbCommand (11ms) [Parameters=[@__p_0='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
ORDER BY [p].[Id]
OFFSET @__p_0 ROWS FETCH NEXT @__p_1 ROWS ONLY
2025-10-25 00:04:25.147 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Products] AS [p]
2025-10-25 00:04:25.157 +01:00 [INF] Executed endpoint 'HTTP: GET /Products'
2025-10-25 00:04:25.160 +01:00 [INF] Request finished HTTP/1.1 GET https://localhost:57679/products - 200 null application/json; charset=utf-8 134.1436ms
2025-10-25 00:04:27.055 +01:00 [INF] Request starting HTTP/1.1 GET https://localhost:57679/products/1 - null null
2025-10-25 00:04:27.056 +01:00 [INF] Executing endpoint 'HTTP: GET /Products/{ProductId}'
2025-10-25 00:04:27.198 +01:00 [INF] Executed DbCommand (64ms) [Parameters=[@__productId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
WHERE [p].[Id] = @__productId_0
2025-10-25 00:04:27.221 +01:00 [INF] Setting HTTP status code 200.
2025-10-25 00:04:27.221 +01:00 [INF] Writing value of type 'ProductRecord' as Json.
2025-10-25 00:04:27.222 +01:00 [INF] Executed endpoint 'HTTP: GET /Products/{ProductId}'
2025-10-25 00:04:27.222 +01:00 [INF] Request finished HTTP/1.1 GET https://localhost:57679/products/1 - 200 null application/json; charset=utf-8 167.9635ms
2025-10-25 00:04:29.746 +01:00 [INF] Request starting HTTP/1.1 POST https://localhost:57679/cart - application/json 37
2025-10-25 00:04:29.747 +01:00 [INF] Executing endpoint 'HTTP: POST /cart'
2025-10-25 00:04:29.765 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[@__productId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
WHERE [p].[Id] = @__productId_0
2025-10-25 00:04:29.846 +01:00 [INF] Executed DbCommand (18ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Carts] ([Id], [CreatedOn], [Deleted])
VALUES (@p0, @p1, @p2);
2025-10-25 00:04:29.896 +01:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Guid), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p7='?' (DbType = Guid), @p5='?' (DbType = DateTime2), @p6='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [CartItems] ([Id], [CartId], [ProductId], [Quantity], [UnitPrice])
VALUES (@p0, @p1, @p2, @p3, @p4);
UPDATE [Carts] SET [CreatedOn] = @p5, [Deleted] = @p6
OUTPUT 1
WHERE [Id] = @p7;
2025-10-25 00:04:29.909 +01:00 [INF] Setting HTTP status code 200.
2025-10-25 00:04:29.912 +01:00 [INF] Writing value of type 'CartResponse' as Json.
2025-10-25 00:04:29.913 +01:00 [INF] Executed endpoint 'HTTP: POST /cart'
2025-10-25 00:04:29.914 +01:00 [INF] Request finished HTTP/1.1 POST https://localhost:57679/cart - 200 null application/json; charset=utf-8 167.2982ms
2025-10-25 00:04:46.913 +01:00 [INF] Request starting HTTP/1.1 POST https://localhost:57679/cart - application/json 89
2025-10-25 00:04:46.913 +01:00 [INF] Executing endpoint 'HTTP: POST /cart'
2025-10-25 00:04:46.918 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[@__productId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
WHERE [p].[Id] = @__productId_0
2025-10-25 00:04:46.972 +01:00 [INF] Executed DbCommand (12ms) [Parameters=[@__cartId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedOn], [c1].[Deleted], [c0].[Id], [c0].[CartId], [c0].[ProductId], [c0].[Quantity], [c0].[UnitPrice]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedOn], [c].[Deleted]
    FROM [Carts] AS [c]
    WHERE [c].[Id] = @__cartId_0 AND [c].[Deleted] = CAST(0 AS bit)
) AS [c1]
LEFT JOIN [CartItems] AS [c0] ON [c1].[Id] = [c0].[CartId]
ORDER BY [c1].[Id]
2025-10-25 00:04:46.984 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Guid), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p7='?' (DbType = Guid), @p5='?' (DbType = DateTime2), @p6='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [CartItems] ([Id], [CartId], [ProductId], [Quantity], [UnitPrice])
VALUES (@p0, @p1, @p2, @p3, @p4);
UPDATE [Carts] SET [CreatedOn] = @p5, [Deleted] = @p6
OUTPUT 1
WHERE [Id] = @p7;
2025-10-25 00:04:46.992 +01:00 [INF] Setting HTTP status code 200.
2025-10-25 00:04:46.992 +01:00 [INF] Writing value of type 'CartResponse' as Json.
2025-10-25 00:04:46.993 +01:00 [INF] Executed endpoint 'HTTP: POST /cart'
2025-10-25 00:04:46.993 +01:00 [INF] Request finished HTTP/1.1 POST https://localhost:57679/cart - 200 null application/json; charset=utf-8 79.7515ms
2025-10-25 00:04:48.963 +01:00 [INF] Request starting HTTP/1.1 POST https://localhost:57679/cart - application/json 89
2025-10-25 00:04:48.964 +01:00 [INF] Executing endpoint 'HTTP: POST /cart'
2025-10-25 00:04:48.970 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[@__productId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
WHERE [p].[Id] = @__productId_0
2025-10-25 00:04:48.973 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[@__cartId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedOn], [c1].[Deleted], [c0].[Id], [c0].[CartId], [c0].[ProductId], [c0].[Quantity], [c0].[UnitPrice]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedOn], [c].[Deleted]
    FROM [Carts] AS [c]
    WHERE [c].[Id] = @__cartId_0 AND [c].[Deleted] = CAST(0 AS bit)
) AS [c1]
LEFT JOIN [CartItems] AS [c0] ON [c1].[Id] = [c0].[CartId]
ORDER BY [c1].[Id]
2025-10-25 00:04:48.979 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Guid), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p7='?' (DbType = Guid), @p5='?' (DbType = DateTime2), @p6='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [CartItems] ([Id], [CartId], [ProductId], [Quantity], [UnitPrice])
VALUES (@p0, @p1, @p2, @p3, @p4);
UPDATE [Carts] SET [CreatedOn] = @p5, [Deleted] = @p6
OUTPUT 1
WHERE [Id] = @p7;
2025-10-25 00:04:48.988 +01:00 [INF] Setting HTTP status code 200.
2025-10-25 00:04:48.988 +01:00 [INF] Writing value of type 'CartResponse' as Json.
2025-10-25 00:04:48.988 +01:00 [INF] Executed endpoint 'HTTP: POST /cart'
2025-10-25 00:04:48.989 +01:00 [INF] Request finished HTTP/1.1 POST https://localhost:57679/cart - 200 null application/json; charset=utf-8 25.3131ms
2025-10-25 00:04:51.771 +01:00 [INF] Request starting HTTP/1.1 GET https://localhost:57679/cart/45d388ee-c86c-47cf-a4aa-58f7e1c304bb - null null
2025-10-25 00:04:51.771 +01:00 [INF] Executing endpoint 'HTTP: GET /cart/{CartId}'
2025-10-25 00:04:51.779 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[@__cartId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedOn], [c1].[Deleted], [c0].[Id], [c0].[CartId], [c0].[ProductId], [c0].[Quantity], [c0].[UnitPrice]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedOn], [c].[Deleted]
    FROM [Carts] AS [c]
    WHERE [c].[Id] = @__cartId_0 AND [c].[Deleted] = CAST(0 AS bit)
) AS [c1]
LEFT JOIN [CartItems] AS [c0] ON [c1].[Id] = [c0].[CartId]
ORDER BY [c1].[Id]
2025-10-25 00:04:51.780 +01:00 [INF] Setting HTTP status code 200.
2025-10-25 00:04:51.780 +01:00 [INF] Writing value of type 'CartResponse' as Json.
2025-10-25 00:04:51.781 +01:00 [INF] Executed endpoint 'HTTP: GET /cart/{CartId}'
2025-10-25 00:04:51.781 +01:00 [INF] Request finished HTTP/1.1 GET https://localhost:57679/cart/45d388ee-c86c-47cf-a4aa-58f7e1c304bb - 200 null application/json; charset=utf-8 9.6016ms
2025-10-25 00:04:56.163 +01:00 [INF] Request starting HTTP/1.1 POST https://localhost:57679/checkout - application/json 86
2025-10-25 00:04:56.164 +01:00 [INF] Request finished HTTP/1.1 POST https://localhost:57679/checkout - 404 0 null 0.9255ms
2025-10-25 00:04:56.164 +01:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST https://localhost:57679/checkout, Response status code: 404
2025-10-25 00:11:12.160 +01:00 [INF] Registered 5 endpoints in 220 milliseconds.
2025-10-25 00:11:12.320 +01:00 [WRN] DROPPING database for fresh start (DatabaseOptions:RecreateOnStartup = true)...
2025-10-25 00:11:13.040 +01:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-25 00:11:16.164 +01:00 [INF] Executed DbCommand (3,045ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [AppDb] SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
END;
2025-10-25 00:11:16.223 +01:00 [INF] Executed DbCommand (58ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
DROP DATABASE [AppDb];
2025-10-25 00:11:16.232 +01:00 [INF] Database dropped.
2025-10-25 00:11:16.232 +01:00 [INF] Applying database migrations...
2025-10-25 00:11:16.599 +01:00 [INF] Executed DbCommand (278ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [AppDb];
2025-10-25 00:11:16.776 +01:00 [INF] Executed DbCommand (176ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [AppDb] SET READ_COMMITTED_SNAPSHOT ON;
END;
2025-10-25 00:11:16.824 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-25 00:11:16.827 +01:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-25 00:11:16.848 +01:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-25 00:11:16.908 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-25 00:11:16.933 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-25 00:11:16.935 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-25 00:11:16.975 +01:00 [INF] Executed DbCommand (37ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-25 00:11:16.985 +01:00 [INF] Applying migration '20251020223304_Initial'.
2025-10-25 00:11:17.033 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Carts] (
    [Id] uniqueidentifier NOT NULL,
    [CreatedOn] datetime2 NOT NULL,
    [Deleted] bit NOT NULL,
    CONSTRAINT [PK_Carts] PRIMARY KEY ([Id])
);
2025-10-25 00:11:17.035 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Products] (
    [Id] int NOT NULL,
    [Name] nvarchar(100) NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    CONSTRAINT [PK_Products] PRIMARY KEY ([Id])
);
2025-10-25 00:11:17.038 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [CartItems] (
    [Id] uniqueidentifier NOT NULL,
    [ProductId] int NOT NULL,
    [Quantity] int NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    [CartId] uniqueidentifier NULL,
    CONSTRAINT [PK_CartItems] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_CartItems_Carts_CartId] FOREIGN KEY ([CartId]) REFERENCES [Carts] ([Id])
);
2025-10-25 00:11:17.093 +01:00 [INF] Executed DbCommand (55ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name', N'UnitPrice') AND [object_id] = OBJECT_ID(N'[Products]'))
    SET IDENTITY_INSERT [Products] ON;
INSERT INTO [Products] ([Id], [Name], [UnitPrice])
VALUES (1, N'Laptop', 999.99),
(2, N'Smartphone', 499.99),
(3, N'Tablet', 299.99);
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name', N'UnitPrice') AND [object_id] = OBJECT_ID(N'[Products]'))
    SET IDENTITY_INSERT [Products] OFF;
2025-10-25 00:11:17.095 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_CartItems_CartId] ON [CartItems] ([CartId]);
2025-10-25 00:11:17.098 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20251020223304_Initial', N'9.0.10');
2025-10-25 00:11:17.111 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-25 00:11:17.113 +01:00 [INF] Database migrations applied successfully.
2025-10-25 00:11:17.247 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Products] AS [p]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-25 00:11:17.249 +01:00 [INF] DB has data - seeding not required.
2025-10-25 00:11:17.424 +01:00 [INF] Now listening on: https://localhost:54621
2025-10-25 00:11:17.427 +01:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-10-25 00:11:17.890 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-25 00:11:17.890 +01:00 [INF] Hosting environment: Development
2025-10-25 00:11:17.890 +01:00 [INF] Content root path: C:\dev\github-ardalis\VerticalCleanModularMicroservices\02-CleanArchitecture\src\OrderDemo.CleanArch.Web
2025-10-25 00:11:21.834 +01:00 [INF] Request starting HTTP/1.1 GET https://localhost:57679/products - null null
2025-10-25 00:11:21.858 +01:00 [INF] Executing endpoint 'HTTP: GET /Products'
2025-10-25 00:11:21.927 +01:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_0='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
ORDER BY [p].[Id]
OFFSET @__p_0 ROWS FETCH NEXT @__p_1 ROWS ONLY
2025-10-25 00:11:21.950 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Products] AS [p]
2025-10-25 00:11:21.960 +01:00 [INF] Executed endpoint 'HTTP: GET /Products'
2025-10-25 00:11:21.962 +01:00 [INF] Request finished HTTP/1.1 GET https://localhost:57679/products - 200 null application/json; charset=utf-8 134.1335ms
2025-10-25 00:11:23.961 +01:00 [INF] Request starting HTTP/1.1 GET https://localhost:57679/products/1 - null null
2025-10-25 00:11:23.962 +01:00 [INF] Executing endpoint 'HTTP: GET /Products/{ProductId}'
2025-10-25 00:11:24.057 +01:00 [INF] Executed DbCommand (20ms) [Parameters=[@__productId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
WHERE [p].[Id] = @__productId_0
2025-10-25 00:11:24.078 +01:00 [INF] Setting HTTP status code 200.
2025-10-25 00:11:24.078 +01:00 [INF] Writing value of type 'ProductRecord' as Json.
2025-10-25 00:11:24.079 +01:00 [INF] Executed endpoint 'HTTP: GET /Products/{ProductId}'
2025-10-25 00:11:24.079 +01:00 [INF] Request finished HTTP/1.1 GET https://localhost:57679/products/1 - 200 null application/json; charset=utf-8 118.5979ms
2025-10-25 00:11:26.028 +01:00 [INF] Request starting HTTP/1.1 POST https://localhost:57679/cart - application/json 37
2025-10-25 00:11:26.029 +01:00 [INF] Executing endpoint 'HTTP: POST /cart'
2025-10-25 00:11:26.046 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[@__productId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
WHERE [p].[Id] = @__productId_0
2025-10-25 00:11:26.116 +01:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Carts] ([Id], [CreatedOn], [Deleted])
VALUES (@p0, @p1, @p2);
2025-10-25 00:11:26.169 +01:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Guid), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p7='?' (DbType = Guid), @p5='?' (DbType = DateTime2), @p6='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [CartItems] ([Id], [CartId], [ProductId], [Quantity], [UnitPrice])
VALUES (@p0, @p1, @p2, @p3, @p4);
UPDATE [Carts] SET [CreatedOn] = @p5, [Deleted] = @p6
OUTPUT 1
WHERE [Id] = @p7;
2025-10-25 00:11:26.184 +01:00 [INF] Setting HTTP status code 200.
2025-10-25 00:11:26.187 +01:00 [INF] Writing value of type 'CartResponse' as Json.
2025-10-25 00:11:26.188 +01:00 [INF] Executed endpoint 'HTTP: POST /cart'
2025-10-25 00:11:26.188 +01:00 [INF] Request finished HTTP/1.1 POST https://localhost:57679/cart - 200 null application/json; charset=utf-8 159.8756ms
2025-10-25 00:11:40.386 +01:00 [INF] Request starting HTTP/1.1 POST https://localhost:57679/cart - application/json 89
2025-10-25 00:11:40.386 +01:00 [INF] Executing endpoint 'HTTP: POST /cart'
2025-10-25 00:11:40.391 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[@__productId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
WHERE [p].[Id] = @__productId_0
2025-10-25 00:11:40.452 +01:00 [INF] Executed DbCommand (19ms) [Parameters=[@__cartId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedOn], [c1].[Deleted], [c0].[Id], [c0].[CartId], [c0].[ProductId], [c0].[Quantity], [c0].[UnitPrice]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedOn], [c].[Deleted]
    FROM [Carts] AS [c]
    WHERE [c].[Id] = @__cartId_0 AND [c].[Deleted] = CAST(0 AS bit)
) AS [c1]
LEFT JOIN [CartItems] AS [c0] ON [c1].[Id] = [c0].[CartId]
ORDER BY [c1].[Id]
2025-10-25 00:11:40.463 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Guid), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p7='?' (DbType = Guid), @p5='?' (DbType = DateTime2), @p6='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [CartItems] ([Id], [CartId], [ProductId], [Quantity], [UnitPrice])
VALUES (@p0, @p1, @p2, @p3, @p4);
UPDATE [Carts] SET [CreatedOn] = @p5, [Deleted] = @p6
OUTPUT 1
WHERE [Id] = @p7;
2025-10-25 00:11:40.471 +01:00 [INF] Setting HTTP status code 200.
2025-10-25 00:11:40.471 +01:00 [INF] Writing value of type 'CartResponse' as Json.
2025-10-25 00:11:40.472 +01:00 [INF] Executed endpoint 'HTTP: POST /cart'
2025-10-25 00:11:40.472 +01:00 [INF] Request finished HTTP/1.1 POST https://localhost:57679/cart - 200 null application/json; charset=utf-8 85.9974ms
2025-10-25 00:11:42.678 +01:00 [INF] Request starting HTTP/1.1 POST https://localhost:57679/cart - application/json 89
2025-10-25 00:11:42.679 +01:00 [INF] Executing endpoint 'HTTP: POST /cart'
2025-10-25 00:11:42.686 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[@__productId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
WHERE [p].[Id] = @__productId_0
2025-10-25 00:11:42.689 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[@__cartId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedOn], [c1].[Deleted], [c0].[Id], [c0].[CartId], [c0].[ProductId], [c0].[Quantity], [c0].[UnitPrice]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedOn], [c].[Deleted]
    FROM [Carts] AS [c]
    WHERE [c].[Id] = @__cartId_0 AND [c].[Deleted] = CAST(0 AS bit)
) AS [c1]
LEFT JOIN [CartItems] AS [c0] ON [c1].[Id] = [c0].[CartId]
ORDER BY [c1].[Id]
2025-10-25 00:11:42.693 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Guid), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p7='?' (DbType = Guid), @p5='?' (DbType = DateTime2), @p6='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [CartItems] ([Id], [CartId], [ProductId], [Quantity], [UnitPrice])
VALUES (@p0, @p1, @p2, @p3, @p4);
UPDATE [Carts] SET [CreatedOn] = @p5, [Deleted] = @p6
OUTPUT 1
WHERE [Id] = @p7;
2025-10-25 00:11:42.710 +01:00 [INF] Setting HTTP status code 200.
2025-10-25 00:11:42.710 +01:00 [INF] Writing value of type 'CartResponse' as Json.
2025-10-25 00:11:42.710 +01:00 [INF] Executed endpoint 'HTTP: POST /cart'
2025-10-25 00:11:42.710 +01:00 [INF] Request finished HTTP/1.1 POST https://localhost:57679/cart - 200 null application/json; charset=utf-8 31.9528ms
2025-10-25 00:11:44.619 +01:00 [INF] Request starting HTTP/1.1 GET https://localhost:57679/cart/ac31310b-f530-4b86-ae7e-8cb7ab20f8dc - null null
2025-10-25 00:11:44.620 +01:00 [INF] Executing endpoint 'HTTP: GET /cart/{CartId}'
2025-10-25 00:11:44.627 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[@__cartId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedOn], [c1].[Deleted], [c0].[Id], [c0].[CartId], [c0].[ProductId], [c0].[Quantity], [c0].[UnitPrice]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedOn], [c].[Deleted]
    FROM [Carts] AS [c]
    WHERE [c].[Id] = @__cartId_0 AND [c].[Deleted] = CAST(0 AS bit)
) AS [c1]
LEFT JOIN [CartItems] AS [c0] ON [c1].[Id] = [c0].[CartId]
ORDER BY [c1].[Id]
2025-10-25 00:11:44.628 +01:00 [INF] Setting HTTP status code 200.
2025-10-25 00:11:44.628 +01:00 [INF] Writing value of type 'CartResponse' as Json.
2025-10-25 00:11:44.628 +01:00 [INF] Executed endpoint 'HTTP: GET /cart/{CartId}'
2025-10-25 00:11:44.628 +01:00 [INF] Request finished HTTP/1.1 GET https://localhost:57679/cart/ac31310b-f530-4b86-ae7e-8cb7ab20f8dc - 200 null application/json; charset=utf-8 8.9301ms
2025-10-25 00:11:48.569 +01:00 [INF] Request starting HTTP/1.1 POST https://localhost:57679/cart/ac31310b-f530-4b86-ae7e-8cb7ab20f8dc/checkout - application/json 34
2025-10-25 00:11:48.570 +01:00 [INF] Executing endpoint 'HTTP: POST /cart/{CartId}/checkout'
2025-10-25 00:11:48.581 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[@__cartId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedOn], [c1].[Deleted], [c0].[Id], [c0].[CartId], [c0].[ProductId], [c0].[Quantity], [c0].[UnitPrice]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedOn], [c].[Deleted]
    FROM [Carts] AS [c]
    WHERE [c].[Id] = @__cartId_0 AND [c].[Deleted] = CAST(0 AS bit)
) AS [c1]
LEFT JOIN [CartItems] AS [c0] ON [c1].[Id] = [c0].[CartId]
ORDER BY [c1].[Id]
2025-10-25 00:11:48.592 +01:00 [INF] Executed endpoint 'HTTP: POST /cart/{CartId}/checkout'
2025-10-25 00:11:48.593 +01:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Cannot create a DbSet for 'GuestUser' because this type is not included in the model for the context.
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.get_EntityType()
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.CheckState()
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.get_EntityQueryable()
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.System.Linq.IQueryable.get_Provider()
   at System.Linq.Queryable.Where[TSource](IQueryable`1 source, Expression`1 predicate)
   at Ardalis.Specification.WhereEvaluator.GetQuery[T](IQueryable`1 query, ISpecification`1 specification)
   at Ardalis.Specification.EntityFrameworkCore.SpecificationEvaluator.GetQuery[T](IQueryable`1 query, ISpecification`1 specification, Boolean evaluateCriteriaOnly)
   at Ardalis.Specification.EntityFrameworkCore.RepositoryBase`1.ApplySpecification(ISpecification`1 specification, Boolean evaluateCriteriaOnly)
   at Ardalis.Specification.EntityFrameworkCore.RepositoryBase`1.FirstOrDefaultAsync(ISpecification`1 specification, CancellationToken cancellationToken)
   at OrderDemo.CleanArch.UseCases.Cart.Checkout.CheckoutHandler.Handle(CheckoutCommand request, CancellationToken cancellationToken) in C:\dev\github-ardalis\VerticalCleanModularMicroservices\02-CleanArchitecture\src\OrderDemo.CleanArch.UseCases\Cart\Checkout\CheckoutHandler.cs:line 27
   at OrderDemo.CleanArch.Web.Cart.Checkout.ExecuteAsync(CheckoutRequest request, CancellationToken ct) in C:\dev\github-ardalis\VerticalCleanModularMicroservices\02-CleanArchitecture\src\OrderDemo.CleanArch.Web\Cart\Checkout.cs:line 55
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at NSwag.AspNetCore.Middlewares.SwaggerUiIndexMiddleware.Invoke(HttpContext context)
   at NSwag.AspNetCore.Middlewares.RedirectToIndexMiddleware.Invoke(HttpContext context)
   at NSwag.AspNetCore.Middlewares.OpenApiDocumentMiddleware.Invoke(HttpContext context)
   at Ardalis.ListStartupServices.ShowAllServicesMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-10-25 00:11:48.622 +01:00 [INF] Request finished HTTP/1.1 POST https://localhost:57679/cart/ac31310b-f530-4b86-ae7e-8cb7ab20f8dc/checkout - 500 null text/plain; charset=utf-8 52.5517ms
2025-10-25 00:14:17.760 +01:00 [INF] Registered 5 endpoints in 215 milliseconds.
2025-10-25 00:14:17.910 +01:00 [WRN] DROPPING database for fresh start (DatabaseOptions:RecreateOnStartup = true)...
2025-10-25 00:14:18.684 +01:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-25 00:14:21.790 +01:00 [INF] Executed DbCommand (3,023ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [AppDb] SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
END;
2025-10-25 00:14:21.836 +01:00 [INF] Executed DbCommand (45ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
DROP DATABASE [AppDb];
2025-10-25 00:14:21.839 +01:00 [INF] Database dropped.
2025-10-25 00:14:21.839 +01:00 [INF] Applying database migrations...
2025-10-25 00:14:22.208 +01:00 [INF] Executed DbCommand (280ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [AppDb];
2025-10-25 00:14:22.384 +01:00 [INF] Executed DbCommand (176ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [AppDb] SET READ_COMMITTED_SNAPSHOT ON;
END;
2025-10-25 00:14:22.436 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-25 00:14:22.439 +01:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-25 00:14:22.457 +01:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-25 00:14:22.503 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-25 00:14:22.522 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-25 00:14:22.524 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-25 00:14:22.554 +01:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-25 00:14:22.561 +01:00 [INF] Applying migration '20251020223304_Initial'.
2025-10-25 00:14:22.586 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Carts] (
    [Id] uniqueidentifier NOT NULL,
    [CreatedOn] datetime2 NOT NULL,
    [Deleted] bit NOT NULL,
    CONSTRAINT [PK_Carts] PRIMARY KEY ([Id])
);
2025-10-25 00:14:22.589 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Products] (
    [Id] int NOT NULL,
    [Name] nvarchar(100) NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    CONSTRAINT [PK_Products] PRIMARY KEY ([Id])
);
2025-10-25 00:14:22.591 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [CartItems] (
    [Id] uniqueidentifier NOT NULL,
    [ProductId] int NOT NULL,
    [Quantity] int NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    [CartId] uniqueidentifier NULL,
    CONSTRAINT [PK_CartItems] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_CartItems_Carts_CartId] FOREIGN KEY ([CartId]) REFERENCES [Carts] ([Id])
);
2025-10-25 00:14:22.649 +01:00 [INF] Executed DbCommand (58ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name', N'UnitPrice') AND [object_id] = OBJECT_ID(N'[Products]'))
    SET IDENTITY_INSERT [Products] ON;
INSERT INTO [Products] ([Id], [Name], [UnitPrice])
VALUES (1, N'Laptop', 999.99),
(2, N'Smartphone', 499.99),
(3, N'Tablet', 299.99);
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name', N'UnitPrice') AND [object_id] = OBJECT_ID(N'[Products]'))
    SET IDENTITY_INSERT [Products] OFF;
2025-10-25 00:14:22.652 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_CartItems_CartId] ON [CartItems] ([CartId]);
2025-10-25 00:14:22.655 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20251020223304_Initial', N'9.0.10');
2025-10-25 00:14:22.655 +01:00 [INF] Applying migration '20251024231324_AddGuestUsersAndOrders'.
2025-10-25 00:14:22.770 +01:00 [ERR] Failed executing DbCommand (96ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var sysname;
SELECT @var = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Products]') AND [c].[name] = N'UnitPrice');
IF @var IS NOT NULL EXEC(N'ALTER TABLE [Products] DROP CONSTRAINT [' + @var + '];');
ALTER TABLE [Products] ALTER COLUMN [UnitPrice] TEXT NOT NULL;
2025-10-25 00:14:22.775 +01:00 [ERR] An error occurred seeding the DB. Operand type clash: decimal is incompatible with text
Microsoft.Data.SqlClient.SqlException (0x80131904): Operand type clash: decimal is incompatible with text
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlCommand.InternalEndExecuteNonQuery(IAsyncResult asyncResult, Boolean isInternal, String endMethod)
   at Microsoft.Data.SqlClient.SqlCommand.EndExecuteNonQueryInternal(IAsyncResult asyncResult)
   at Microsoft.Data.SqlClient.SqlCommand.EndExecuteNonQueryAsync(IAsyncResult asyncResult)
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<InternalExecuteNonQueryAsync>b__210_1(IAsyncResult result)
   at System.Threading.Tasks.TaskFactory`1.FromAsyncCoreLogic(IAsyncResult iar, Func`2 endFunction, Action`1 endAction, Task`1 promise, Boolean requiresSynchronization)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.Internal.MigrationCommandExecutor.ExecuteAsync(IReadOnlyList`1 migrationCommands, IRelationalConnection connection, MigrationExecutionState executionState, Boolean beginTransaction, Boolean commitTransaction, Nullable`1 isolationLevel, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.Internal.MigrationCommandExecutor.ExecuteAsync(IReadOnlyList`1 migrationCommands, IRelationalConnection connection, MigrationExecutionState executionState, Boolean beginTransaction, Boolean commitTransaction, Nullable`1 isolationLevel, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.Internal.MigrationCommandExecutor.ExecuteNonQueryAsync(IReadOnlyList`1 migrationCommands, IRelationalConnection connection, MigrationExecutionState executionState, Boolean commitTransaction, Nullable`1 isolationLevel, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.MigrateImplementationAsync(DbContext context, String targetMigration, MigrationExecutionState state, Boolean useTransaction, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.MigrateImplementationAsync(DbContext context, String targetMigration, MigrationExecutionState state, Boolean useTransaction, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.<>c.<<MigrateAsync>b__22_1>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at OrderDemo.CleanArch.Web.Configurations.MiddlewareConfig.SeedDatabase(WebApplication app) in C:\dev\github-ardalis\VerticalCleanModularMicroservices\02-CleanArchitecture\src\OrderDemo.CleanArch.Web\Configurations\MiddlewareConfig.cs:line 63
ClientConnectionId:eb1523a3-6909-4501-9d04-c4d4cad1090b
Error Number:206,State:2,Class:16
2025-10-25 00:14:22.909 +01:00 [INF] Now listening on: https://localhost:64766
2025-10-25 00:14:22.911 +01:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-10-25 00:14:23.118 +01:00 [INF] Request starting HTTP/1.1 POST https://localhost:57679/cart - application/json 89
2025-10-25 00:14:23.136 +01:00 [INF] Executing endpoint 'HTTP: POST /cart'
2025-10-25 00:14:23.256 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-25 00:14:23.257 +01:00 [INF] Hosting environment: Development
2025-10-25 00:14:23.257 +01:00 [INF] Content root path: C:\dev\github-ardalis\VerticalCleanModularMicroservices\02-CleanArchitecture\src\OrderDemo.CleanArch.Web
2025-10-25 00:14:23.329 +01:00 [ERR] Failed executing DbCommand (9ms) [Parameters=[@__productId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
WHERE [p].[Id] = @__productId_0
2025-10-25 00:14:23.332 +01:00 [ERR] An exception occurred while iterating over the results of a query for context type 'OrderDemo.CleanArch.Infrastructure.Data.AppDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid object name 'Products'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:eb1523a3-6909-4501-9d04-c4d4cad1090b
Error Number:208,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid object name 'Products'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:eb1523a3-6909-4501-9d04-c4d4cad1090b
Error Number:208,State:1,Class:16
2025-10-25 00:14:23.335 +01:00 [INF] Executed endpoint 'HTTP: POST /cart'
2025-10-25 00:14:23.335 +01:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid object name 'Products'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Ardalis.Specification.EntityFrameworkCore.RepositoryBase`1.FirstOrDefaultAsync(ISpecification`1 specification, CancellationToken cancellationToken)
   at OrderDemo.CleanArch.UseCases.Cart.AddToCart.AddToCartHandler.Handle(AddToCartCommand request, CancellationToken cancellationToken) in C:\dev\github-ardalis\VerticalCleanModularMicroservices\02-CleanArchitecture\src\OrderDemo.CleanArch.UseCases\Cart\AddToCart\AddToCartHandler.cs:line 17
   at OrderDemo.CleanArch.Web.Cart.AddToCart.ExecuteAsync(AddToCartRequest request, CancellationToken ct) in C:\dev\github-ardalis\VerticalCleanModularMicroservices\02-CleanArchitecture\src\OrderDemo.CleanArch.Web\Cart\AddToCart.cs:line 62
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at NSwag.AspNetCore.Middlewares.SwaggerUiIndexMiddleware.Invoke(HttpContext context)
   at NSwag.AspNetCore.Middlewares.RedirectToIndexMiddleware.Invoke(HttpContext context)
   at NSwag.AspNetCore.Middlewares.OpenApiDocumentMiddleware.Invoke(HttpContext context)
   at Ardalis.ListStartupServices.ShowAllServicesMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
ClientConnectionId:eb1523a3-6909-4501-9d04-c4d4cad1090b
Error Number:208,State:1,Class:16
2025-10-25 00:14:23.349 +01:00 [INF] Request finished HTTP/1.1 POST https://localhost:57679/cart - 500 null text/plain; charset=utf-8 237.3804ms
2025-10-25 00:14:30.232 +01:00 [INF] Request starting HTTP/1.1 GET https://localhost:57679/products - null null
2025-10-25 00:14:30.234 +01:00 [INF] Executing endpoint 'HTTP: GET /Products'
2025-10-25 00:14:30.293 +01:00 [ERR] Failed executing DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
ORDER BY [p].[Id]
OFFSET @__p_0 ROWS FETCH NEXT @__p_1 ROWS ONLY
2025-10-25 00:14:30.293 +01:00 [ERR] An exception occurred while iterating over the results of a query for context type 'OrderDemo.CleanArch.Infrastructure.Data.AppDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid object name 'Products'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:eb1523a3-6909-4501-9d04-c4d4cad1090b
Error Number:208,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid object name 'Products'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:eb1523a3-6909-4501-9d04-c4d4cad1090b
Error Number:208,State:1,Class:16
2025-10-25 00:14:30.294 +01:00 [INF] Executed endpoint 'HTTP: GET /Products'
2025-10-25 00:14:30.294 +01:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid object name 'Products'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at OrderDemo.CleanArch.Infrastructure.Data.Queries.ListProductsQueryService.ListAsync(Int32 page, Int32 perPage) in C:\dev\github-ardalis\VerticalCleanModularMicroservices\02-CleanArchitecture\src\OrderDemo.CleanArch.Infrastructure\Data\Queries\ListProductsQueryService.cs:line 18
   at OrderDemo.CleanArch.UseCases.Products.List.ListProductsHandler.Handle(ListProductsQuery request, CancellationToken cancellationToken) in C:\dev\github-ardalis\VerticalCleanModularMicroservices\02-CleanArchitecture\src\OrderDemo.CleanArch.UseCases\Products\List\ListProductsHandler.cs:line 16
   at OrderDemo.CleanArch.Web.Products.List.HandleAsync(ListProductsRequest request, CancellationToken cancellationToken) in C:\dev\github-ardalis\VerticalCleanModularMicroservices\02-CleanArchitecture\src\OrderDemo.CleanArch.Web\Products\List.cs:line 47
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at NSwag.AspNetCore.Middlewares.SwaggerUiIndexMiddleware.Invoke(HttpContext context)
   at NSwag.AspNetCore.Middlewares.RedirectToIndexMiddleware.Invoke(HttpContext context)
   at NSwag.AspNetCore.Middlewares.OpenApiDocumentMiddleware.Invoke(HttpContext context)
   at Ardalis.ListStartupServices.ShowAllServicesMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
ClientConnectionId:eb1523a3-6909-4501-9d04-c4d4cad1090b
Error Number:208,State:1,Class:16
2025-10-25 00:14:30.317 +01:00 [INF] Request finished HTTP/1.1 GET https://localhost:57679/products - 500 null text/plain; charset=utf-8 84.9082ms
2025-10-25 00:23:19.463 +01:00 [INF] Registered 5 endpoints in 134 milliseconds.
2025-10-25 00:23:19.570 +01:00 [WRN] DROPPING database for fresh start (DatabaseOptions:RecreateOnStartup = true)...
2025-10-25 00:23:20.034 +01:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-25 00:23:23.112 +01:00 [INF] Executed DbCommand (3,013ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [AppDb] SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
END;
2025-10-25 00:23:23.159 +01:00 [INF] Executed DbCommand (47ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
DROP DATABASE [AppDb];
2025-10-25 00:23:23.162 +01:00 [INF] Database dropped.
2025-10-25 00:23:23.162 +01:00 [INF] Applying database migrations...
2025-10-25 00:23:23.566 +01:00 [INF] Executed DbCommand (275ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [AppDb];
2025-10-25 00:23:23.730 +01:00 [INF] Executed DbCommand (164ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [AppDb] SET READ_COMMITTED_SNAPSHOT ON;
END;
2025-10-25 00:23:23.779 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-25 00:23:23.782 +01:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-25 00:23:23.798 +01:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-25 00:23:23.835 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-25 00:23:23.855 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-25 00:23:23.858 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-25 00:23:23.889 +01:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-25 00:23:23.897 +01:00 [INF] Applying migration '20251020223304_Initial'.
2025-10-25 00:23:23.919 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Carts] (
    [Id] uniqueidentifier NOT NULL,
    [CreatedOn] datetime2 NOT NULL,
    [Deleted] bit NOT NULL,
    CONSTRAINT [PK_Carts] PRIMARY KEY ([Id])
);
2025-10-25 00:23:23.922 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Products] (
    [Id] int NOT NULL,
    [Name] nvarchar(100) NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    CONSTRAINT [PK_Products] PRIMARY KEY ([Id])
);
2025-10-25 00:23:23.924 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [CartItems] (
    [Id] uniqueidentifier NOT NULL,
    [ProductId] int NOT NULL,
    [Quantity] int NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    [CartId] uniqueidentifier NULL,
    CONSTRAINT [PK_CartItems] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_CartItems_Carts_CartId] FOREIGN KEY ([CartId]) REFERENCES [Carts] ([Id])
);
2025-10-25 00:23:23.985 +01:00 [INF] Executed DbCommand (61ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name', N'UnitPrice') AND [object_id] = OBJECT_ID(N'[Products]'))
    SET IDENTITY_INSERT [Products] ON;
INSERT INTO [Products] ([Id], [Name], [UnitPrice])
VALUES (1, N'Laptop', 999.99),
(2, N'Smartphone', 499.99),
(3, N'Tablet', 299.99);
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name', N'UnitPrice') AND [object_id] = OBJECT_ID(N'[Products]'))
    SET IDENTITY_INSERT [Products] OFF;
2025-10-25 00:23:23.988 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_CartItems_CartId] ON [CartItems] ([CartId]);
2025-10-25 00:23:23.991 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20251020223304_Initial', N'9.0.10');
2025-10-25 00:23:23.992 +01:00 [INF] Applying migration '20251024232246_AddGuestUsersAndOrdersSqlServer'.
2025-10-25 00:23:24.006 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [GuestUsers] (
    [Id] uniqueidentifier NOT NULL,
    [Email] nvarchar(100) NOT NULL,
    CONSTRAINT [PK_GuestUsers] PRIMARY KEY ([Id])
);
2025-10-25 00:23:24.008 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Orders] (
    [Id] uniqueidentifier NOT NULL,
    [CreatedOn] datetimeoffset NOT NULL,
    [GuestUserId] uniqueidentifier NOT NULL,
    [DatePaid] datetimeoffset NULL,
    [PaymentReference] nvarchar(100) NULL,
    CONSTRAINT [PK_Orders] PRIMARY KEY ([Id])
);
2025-10-25 00:23:24.010 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [OrderItems] (
    [Id] uniqueidentifier NOT NULL,
    [OrderId] uniqueidentifier NOT NULL,
    [ProductId] int NOT NULL,
    [Quantity] int NOT NULL,
    [UnitPrice] decimal(18,2) NOT NULL,
    CONSTRAINT [PK_OrderItems] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_OrderItems_Orders_OrderId] FOREIGN KEY ([OrderId]) REFERENCES [Orders] ([Id]) ON DELETE CASCADE
);
2025-10-25 00:23:24.014 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE [Products] SET [Name] = N'Coffee Mug', [UnitPrice] = 9.99
WHERE [Id] = 1;
SELECT @@ROWCOUNT;
2025-10-25 00:23:24.016 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE [Products] SET [Name] = N'T-Shirt', [UnitPrice] = 19.99
WHERE [Id] = 2;
SELECT @@ROWCOUNT;
2025-10-25 00:23:24.018 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE [Products] SET [Name] = N'Sticker Pack', [UnitPrice] = 3.99
WHERE [Id] = 3;
SELECT @@ROWCOUNT;
2025-10-25 00:23:24.020 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_OrderItems_OrderId] ON [OrderItems] ([OrderId]);
2025-10-25 00:23:24.022 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20251024232246_AddGuestUsersAndOrdersSqlServer', N'9.0.10');
2025-10-25 00:23:24.035 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-25 00:23:24.036 +01:00 [INF] Database migrations applied successfully.
2025-10-25 00:23:24.148 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Products] AS [p]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-25 00:23:24.149 +01:00 [INF] DB has data - seeding not required.
2025-10-25 00:23:24.264 +01:00 [INF] Now listening on: https://localhost:53255
2025-10-25 00:23:24.264 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-25 00:23:24.264 +01:00 [INF] Hosting environment: Development
2025-10-25 00:23:24.264 +01:00 [INF] Content root path: C:\dev\github-ardalis\VerticalCleanModularMicroservices\02-CleanArchitecture\src\OrderDemo.CleanArch.Web
2025-10-25 00:24:05.570 +01:00 [INF] Request starting HTTP/1.1 GET https://localhost:57679/products - null null
2025-10-25 00:24:05.631 +01:00 [INF] Executing endpoint 'HTTP: GET /Products'
2025-10-25 00:24:05.778 +01:00 [INF] Executed DbCommand (15ms) [Parameters=[@__p_0='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
ORDER BY [p].[Id]
OFFSET @__p_0 ROWS FETCH NEXT @__p_1 ROWS ONLY
2025-10-25 00:24:05.812 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Products] AS [p]
2025-10-25 00:24:05.838 +01:00 [INF] Executed endpoint 'HTTP: GET /Products'
2025-10-25 00:24:05.842 +01:00 [INF] Request finished HTTP/1.1 GET https://localhost:57679/products - 200 null application/json; charset=utf-8 280.5363ms
2025-10-25 00:24:08.697 +01:00 [INF] Request starting HTTP/1.1 POST https://localhost:57679/cart - application/json 37
2025-10-25 00:24:08.698 +01:00 [INF] Executing endpoint 'HTTP: POST /cart'
2025-10-25 00:24:08.836 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[@__productId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
WHERE [p].[Id] = @__productId_0
2025-10-25 00:24:08.995 +01:00 [INF] Executed DbCommand (20ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Carts] ([Id], [CreatedOn], [Deleted])
VALUES (@p0, @p1, @p2);
2025-10-25 00:24:09.072 +01:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Guid), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p7='?' (DbType = Guid), @p5='?' (DbType = DateTime2), @p6='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [CartItems] ([Id], [CartId], [ProductId], [Quantity], [UnitPrice])
VALUES (@p0, @p1, @p2, @p3, @p4);
UPDATE [Carts] SET [CreatedOn] = @p5, [Deleted] = @p6
OUTPUT 1
WHERE [Id] = @p7;
2025-10-25 00:24:09.093 +01:00 [INF] Setting HTTP status code 200.
2025-10-25 00:24:09.098 +01:00 [INF] Writing value of type 'CartResponse' as Json.
2025-10-25 00:24:09.101 +01:00 [INF] Executed endpoint 'HTTP: POST /cart'
2025-10-25 00:24:09.101 +01:00 [INF] Request finished HTTP/1.1 POST https://localhost:57679/cart - 200 null application/json; charset=utf-8 404.3758ms
2025-10-25 00:24:21.621 +01:00 [INF] Request starting HTTP/1.1 POST https://localhost:57679/cart - application/json 89
2025-10-25 00:24:21.622 +01:00 [INF] Executing endpoint 'HTTP: POST /cart'
2025-10-25 00:24:21.632 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[@__productId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
WHERE [p].[Id] = @__productId_0
2025-10-25 00:24:21.719 +01:00 [INF] Executed DbCommand (12ms) [Parameters=[@__cartId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedOn], [c1].[Deleted], [c0].[Id], [c0].[CartId], [c0].[ProductId], [c0].[Quantity], [c0].[UnitPrice]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedOn], [c].[Deleted]
    FROM [Carts] AS [c]
    WHERE [c].[Id] = @__cartId_0 AND [c].[Deleted] = CAST(0 AS bit)
) AS [c1]
LEFT JOIN [CartItems] AS [c0] ON [c1].[Id] = [c0].[CartId]
ORDER BY [c1].[Id]
2025-10-25 00:24:21.735 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Guid), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p7='?' (DbType = Guid), @p5='?' (DbType = DateTime2), @p6='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [CartItems] ([Id], [CartId], [ProductId], [Quantity], [UnitPrice])
VALUES (@p0, @p1, @p2, @p3, @p4);
UPDATE [Carts] SET [CreatedOn] = @p5, [Deleted] = @p6
OUTPUT 1
WHERE [Id] = @p7;
2025-10-25 00:24:21.743 +01:00 [INF] Setting HTTP status code 200.
2025-10-25 00:24:21.743 +01:00 [INF] Writing value of type 'CartResponse' as Json.
2025-10-25 00:24:21.743 +01:00 [INF] Executed endpoint 'HTTP: POST /cart'
2025-10-25 00:24:21.743 +01:00 [INF] Request finished HTTP/1.1 POST https://localhost:57679/cart - 200 null application/json; charset=utf-8 122.147ms
2025-10-25 00:24:25.359 +01:00 [INF] Request starting HTTP/1.1 POST https://localhost:57679/cart - application/json 89
2025-10-25 00:24:25.359 +01:00 [INF] Executing endpoint 'HTTP: POST /cart'
2025-10-25 00:24:25.367 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[@__productId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[Name], [p].[UnitPrice]
FROM [Products] AS [p]
WHERE [p].[Id] = @__productId_0
2025-10-25 00:24:25.372 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[@__cartId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedOn], [c1].[Deleted], [c0].[Id], [c0].[CartId], [c0].[ProductId], [c0].[Quantity], [c0].[UnitPrice]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedOn], [c].[Deleted]
    FROM [Carts] AS [c]
    WHERE [c].[Id] = @__cartId_0 AND [c].[Deleted] = CAST(0 AS bit)
) AS [c1]
LEFT JOIN [CartItems] AS [c0] ON [c1].[Id] = [c0].[CartId]
ORDER BY [c1].[Id]
2025-10-25 00:24:25.376 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Guid), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p7='?' (DbType = Guid), @p5='?' (DbType = DateTime2), @p6='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [CartItems] ([Id], [CartId], [ProductId], [Quantity], [UnitPrice])
VALUES (@p0, @p1, @p2, @p3, @p4);
UPDATE [Carts] SET [CreatedOn] = @p5, [Deleted] = @p6
OUTPUT 1
WHERE [Id] = @p7;
2025-10-25 00:24:25.392 +01:00 [INF] Setting HTTP status code 200.
2025-10-25 00:24:25.392 +01:00 [INF] Writing value of type 'CartResponse' as Json.
2025-10-25 00:24:25.392 +01:00 [INF] Executed endpoint 'HTTP: POST /cart'
2025-10-25 00:24:25.393 +01:00 [INF] Request finished HTTP/1.1 POST https://localhost:57679/cart - 200 null application/json; charset=utf-8 33.7777ms
2025-10-25 00:24:27.230 +01:00 [INF] Request starting HTTP/1.1 GET https://localhost:57679/cart/68fe4cfd-84bb-4b8a-bb4e-528c26325c72 - null null
2025-10-25 00:24:27.231 +01:00 [INF] Executing endpoint 'HTTP: GET /cart/{CartId}'
2025-10-25 00:24:27.242 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[@__cartId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedOn], [c1].[Deleted], [c0].[Id], [c0].[CartId], [c0].[ProductId], [c0].[Quantity], [c0].[UnitPrice]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedOn], [c].[Deleted]
    FROM [Carts] AS [c]
    WHERE [c].[Id] = @__cartId_0 AND [c].[Deleted] = CAST(0 AS bit)
) AS [c1]
LEFT JOIN [CartItems] AS [c0] ON [c1].[Id] = [c0].[CartId]
ORDER BY [c1].[Id]
2025-10-25 00:24:27.245 +01:00 [INF] Setting HTTP status code 200.
2025-10-25 00:24:27.245 +01:00 [INF] Writing value of type 'CartResponse' as Json.
2025-10-25 00:24:27.245 +01:00 [INF] Executed endpoint 'HTTP: GET /cart/{CartId}'
2025-10-25 00:24:27.245 +01:00 [INF] Request finished HTTP/1.1 GET https://localhost:57679/cart/68fe4cfd-84bb-4b8a-bb4e-528c26325c72 - 200 null application/json; charset=utf-8 15.4391ms
2025-10-25 00:24:29.431 +01:00 [INF] Request starting HTTP/1.1 POST https://localhost:57679/cart/68fe4cfd-84bb-4b8a-bb4e-528c26325c72/checkout - application/json 34
2025-10-25 00:24:29.432 +01:00 [INF] Executing endpoint 'HTTP: POST /cart/{CartId}/checkout'
2025-10-25 00:24:29.458 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[@__cartId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedOn], [c1].[Deleted], [c0].[Id], [c0].[CartId], [c0].[ProductId], [c0].[Quantity], [c0].[UnitPrice]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedOn], [c].[Deleted]
    FROM [Carts] AS [c]
    WHERE [c].[Id] = @__cartId_0 AND [c].[Deleted] = CAST(0 AS bit)
) AS [c1]
LEFT JOIN [CartItems] AS [c0] ON [c1].[Id] = [c0].[CartId]
ORDER BY [c1].[Id]
2025-10-25 00:24:29.471 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[@__email_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[Email]
FROM [GuestUsers] AS [g]
WHERE [g].[Email] = @__email_0
2025-10-25 00:24:29.497 +01:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [GuestUsers] ([Id], [Email])
VALUES (@p0, @p1);
2025-10-25 00:24:29.585 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = DateTimeOffset), @p2='?' (DbType = DateTimeOffset), @p3='?' (DbType = Guid), @p4='?' (Size = 100), @p5='?' (DbType = Guid), @p6='?' (DbType = Guid), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p10='?' (DbType = Guid), @p11='?' (DbType = Guid), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [CreatedOn], [DatePaid], [GuestUserId], [PaymentReference])
VALUES (@p0, @p1, @p2, @p3, @p4);
INSERT INTO [OrderItems] ([Id], [OrderId], [ProductId], [Quantity], [UnitPrice])
VALUES (@p5, @p6, @p7, @p8, @p9),
(@p10, @p11, @p12, @p13, @p14);
2025-10-25 00:24:29.605 +01:00 [INF] Executed DbCommand (10ms) [Parameters=[@p2='?' (DbType = Guid), @p0='?' (DbType = DateTime2), @p1='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Carts] SET [CreatedOn] = @p0, [Deleted] = @p1
OUTPUT 1
WHERE [Id] = @p2;
2025-10-25 00:24:29.606 +01:00 [INF] Setting HTTP status code 200.
2025-10-25 00:24:29.607 +01:00 [INF] Writing value of type 'CheckoutResponse' as Json.
2025-10-25 00:24:29.608 +01:00 [INF] Executed endpoint 'HTTP: POST /cart/{CartId}/checkout'
2025-10-25 00:24:29.608 +01:00 [INF] Request finished HTTP/1.1 POST https://localhost:57679/cart/68fe4cfd-84bb-4b8a-bb4e-528c26325c72/checkout - 200 null application/json; charset=utf-8 177.1355ms
2025-10-25 00:24:47.072 +01:00 [INF] Request starting HTTP/1.1 GET https://localhost:57679/orders?emailAddress=guest@example.com - null null
2025-10-25 00:24:47.072 +01:00 [INF] Request finished HTTP/1.1 GET https://localhost:57679/orders?emailAddress=guest@example.com - 404 0 null 0.7383ms
2025-10-25 00:24:47.073 +01:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET https://localhost:57679/orders, Response status code: 404
